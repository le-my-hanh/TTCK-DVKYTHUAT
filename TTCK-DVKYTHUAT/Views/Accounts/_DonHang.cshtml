@model List<Order>
<div class="tab-pane fade" id="pills-order">
    <div class="my-account-order account-wrapper">
        <h4 class="account-title">Danh sách đơn hàng</h4>
        @if (Model != null && Model.Count() > 0)
        {
      
        <div class="account-table text-center  table-responsive">
             <table class="table">
               <thead>
                <tr>
                    <th class="no">STT</th>
           
                    <th class="date">Ngày Tạo</th>
                    <th class="status">Lịch Hẹn</th>
                    <th class="total">Tổng Hóa Đơn</th>
                    <th class="Status"> Trạng Thái</th>
                    <th class="action">#</th>
                    <th class="action"></th>
                </tr>
             </thead>
            <tbody>
                @foreach(var item in Model)
                {
                        <tr>
                        <td >@item.OrderId</td>
                        <td>@item.CreatedDate</td>
                        <td>@item.AppDate</td>
                        <td>@item.TotalMoney.Value.ToString("#,##0") VNĐ</td>
                        <td >@item.TransactStatus.Status</td>
                                <td><a href="javascript:void(0);" onclick="openModal('@item.OrderId')" style="width:130px;">Xem Chi Tiết</a></td>
                                <td> 
                                    @if (item.TransactStatus.Status != "Đã hủy") // Chỉ hiển thị nút hủy đơn nếu đơn hàng chưa được hủy
                                    {
                                        <button class="btn btn-sm btn-danger" onclick="cancelOrder('@item.OrderId')" style="padding: 3px 8px; font-size: 12px; width:80px;">Hủy Đơn</button>
                                    }
                       </td>
                    </tr>
                }
              
            </tbody>
        </table>
               

      </div>
   
}
else
{
    <h4>Chưa Lịch Hẹn !</h4>
}
    </div>
</div>


<!-- Modal -->
<div class="modal fade" id="orderDetailsModal" tabindex="-1" role="dialog" aria-labelledby="orderDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="orderDetailsModalLabel">Chi Tiết Đơn Hàng</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
               
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>

<script>
    function cancelOrder(orderId) {
        if (confirm('Bạn có chắc chắn muốn hủy đơn hàng này không?')) {
            $.ajax({
                url: '/Checkout/CancelOrder',
                type: 'POST',
                data: { orderId: orderId },
                success: function (result) {
                    if (result.success) {
                        // Xóa hàng đơn hàng khỏi bảng
                        $('#orderRow_' + orderId).remove();
                        // Reload lại trang để cập nhật danh sách đơn hàng
                        location.reload();
                    } else {
                        alert('Đã có lỗi xảy ra: ' + result.message); // Hiển thị thông báo lỗi nếu có
                    }
                },
                error: function () {
                    alert('Đã có lỗi xảy ra, vui lòng thử lại sau.');
                }
            });
        }
    }
</script>

@* @section Scripts{
    <script>
        $(document).ready(function () {
            $(".xemdonhang").click(function () {
                var madonhang = $(this).attr("data-madonhang")
                $.ajax({
                    url: '/DonHang/Details',
                    datatype: "json",
                    type: "POST",
                    data: { id: madonhang },
                    async: true,
                    success: function (results) {
                        $("#records_table").html("");
                        $("#records_table").html("results");
                    },
                    error: function (xhr) {
                        alert('error');
                    }
                });
            });
        });

        
    </script>
}
 *@
